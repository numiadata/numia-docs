---
title: Sample SQL Query
---

This page presents two practical examples of how to query Numiaâ€™s datasets for insights. These examples demonstrate analyzing trades on the Osmosis DEX and querying staking balances on Celestia.


## **Query 1: Trades on Osmosis DEX by Pool**

This query counts all token swaps on the Osmosis DEX and groups the trades by `Pool_ID`, ordering the results by the number of trades in descending order.

```sql
SELECT
  COUNT(*) AS Trades,
  attribute_value AS Pool_ID
FROM `numia-data.osmosis.osmosis_event_attributes`
WHERE event_type = 'token_swapped'  
  AND attribute_key = 'pool_id'
GROUP BY Pool_ID
ORDER BY Trades DESC;
```

### Breakdown:
- **`COUNT(*)`**: Counts the total number of token swaps (trades).  
- **`attribute_value AS Pool_ID`**: Identifies the pool associated with each trade.  
- **`GROUP BY`**: Groups results by `Pool_ID`.  
- **`ORDER BY Trades DESC`**: Orders the pools by the number of trades, from highest to lowest.  

This query helps identify the most active liquidity pools on the Osmosis DEX.

## **Query 2: Staking Balance of a Celestia User**

This query calculates the total staking balance for a specific user (`sender`) at a particular block height by combining their delegations and undelegations.

```sql
SELECT sender, SUM(token_amount) AS token_amount
FROM (
  SELECT sender, token_amount 
  FROM `numia-data.celestia.celestia_delegate`
  WHERE sender = 'celestia1r0gmufmz9em8anlxd8exygwwllhk3ny6g4hqlz'
    AND block_height <= 1654914

  UNION ALL

  SELECT sender, -token_amount
  FROM `numia-data.celestia.celestia_undelegate`
  WHERE sender = 'celestia1r0gmufmz9em8anlxd8exygwwllhk3ny6g4hqlz'
    AND block_height <= 1654914
)
GROUP BY sender
ORDER BY token_amount DESC;
```

### Breakdown:
- **Delegations and Undelegations**:  
  - Delegated amounts are pulled from `celestia_delegate`.  
  - Undelegated amounts are pulled from `celestia_undelegate` as negative values using `-token_amount`.  
- **`UNION ALL`**: Combines both delegated and undelegated amounts for the same user.  
- **`SUM(token_amount)`**: Calculates the net staking balance.  
- **`block_height <= 1654914`**: Ensures the calculation reflects the state at the specified block height.  
- **`GROUP BY sender`**: Groups results by the user.  
- **`ORDER BY token_amount DESC`**: Orders users by staking balance.

This query provides the staking balance for a user at a specific point in time, useful for analyzing user participation in staking.

<Callout type="success" title="Tip">
If you're new to SQL, start with the basics to build a strong foundation. Visit [SQL Tutorials on W3Schools](https://www.w3schools.com/sql/) for an introduction to SQL syntax and best practices.
</Callout>